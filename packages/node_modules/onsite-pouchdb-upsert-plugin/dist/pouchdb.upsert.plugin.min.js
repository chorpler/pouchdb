!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).PouchUpsertPlugin=e()}}(function(){return function i(o,s,c){function a(t,e){if(!s[t]){if(!o[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(f)return f(t,!0);var n=new Error("Cannot find module '"+t+"'");throw n.code="MODULE_NOT_FOUND",n}var u=s[t]={exports:{}};o[t][0].call(u.exports,function(e){return a(o[t][1][e]||e)},u,u.exports,i,o,s,c)}return s[t].exports}for(var f="function"==typeof require&&require,e=0;e<c.length;e++)a(c[e]);return a}({1:[function(e,t,r){"use strict";function d(i,o,s,c){return new(s||(s=Promise))(function(e,t){function r(e){try{u(c.next(e))}catch(e){t(e)}}function n(e){try{u(c.throw(e))}catch(e){t(e)}}function u(t){t.done?e(t.value):new s(function(e){e(t.value)}).then(r,n)}u((c=c.apply(i,o||[])).next())})}function p(r,n){var u,i,o,e,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return e={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function(t){if(u)throw new TypeError("Generator is already executing.");for(;s;)try{if(u=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!(o=0<(o=s.trys).length&&o[o.length-1])&&(6===t[0]||2===t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=n.call(r,s)}catch(e){t=[6,e],i=0}finally{u=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,e])}}}Object.defineProperty(r,"__esModule",{value:!0});var h=50,v=0;function y(a,f,l){return d(this,void 0,void 0,function(){var t,r,n,u,i,o,s,c;return p(this,function(e){switch(e.label){case 0:if(e.trys.push([0,6,,7]),t=!1,h<++v)throw r="Maximum upsert retries of "+h+" exceeded",n=new Error(r),v=0,n;if("string"!=typeof f)throw r="doc id string is required",n=new Error(r),v=0,n;u=void 0,e.label=1;case 1:return e.trys.push([1,3,,4]),[4,a.get(f)];case 2:return u=e.sent(),[3,4];case 3:if(404!==(i=e.sent()).status)throw i;return u=i.reason&&"deleted"===i.reason?(t=!0,[]):{},[3,4];case 4:return o=u&&u._rev?u._rev:"",(s=l(u))?t&&s._deleted?[2,{updated:!1,rev:"",id:f,deleted:!0,message:"cannot re-delete an existing deleted document"}]:(s._id=f,o?s._rev=o:delete s._rev,[4,function(u,i,o){return d(this,void 0,void 0,function(){var t,r,n;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,7]),[4,u.put(i)];case 1:return t=e.sent(),[2,{updated:!0,rev:t.rev,id:i._id}];case 2:if(r=e.sent(),409===(n=r).status)return[3,3];throw n;case 3:return e.trys.push([3,5,,6]),[4,y(u,i._id,o)];case 4:return[2,e.sent()];case 5:throw e.sent();case 6:return[3,7];case 7:return[2]}})})}(a,s,l)]):(v=0,[2,{updated:!1,rev:o,id:f}]);case 5:return c=e.sent(),v=0,[2,c];case 6:throw e.sent();case 7:return[2]}})})}r.upsert=function(t,r){return d(this,void 0,void 0,function(){return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,y(this,t,r)];case 1:return[2,e.sent()];case 2:throw e.sent();case 3:return[2]}})})},r.putIfNotExists=function(r,n){return d(this,void 0,void 0,function(){var t;return p(this,function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),t=this,"string"!=typeof r&&(r=(n=r)._id),[4,y(t,r,function(e){return!e._rev&&n})];case 1:return[2,e.sent()];case 2:throw e.sent();case 3:return[2]}})})}},{}]},{},[1])(1)});
